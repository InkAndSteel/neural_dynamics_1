library(reshape2)
library(ggplot2)
library(ggpubr)
library(dplyr)
with_mask <- read.csv("C_with_mask.csv", header = T)$error_angle_deg
wout_mask <- read.csv("C_without_mask.csv", header = T)$error_angle_deg
# Combine the two vectors into one long vector first
combined_data <- c(with_mask, wout_mask)
# Create a 3D array: [40 timepoints, 5 conditions, 2 mask_states]
data_array <- array(combined_data,
dim = c(40, 5, 2),
dimnames = list(
time = 1:40,
condition = c("ctrl", "grad_perturb", "post_grad_perturb", "sudden_perturb", "post_sudden_perturb"),
mask_state = c("with_mask", "wout_mask")
))
# 1. Flatten the Array (The "Tidy" Step)
# This converts your 40x5x2 array into a long dataframe for analysis
df_long <- melt(data_array,
varnames = c("time", "condition", "mask_state"),
value.name = "error_angle")
# Ensure factor levels are in the logical order you provided (not alphabetical)
df_long$condition <- factor(df_long$condition,
levels = c("ctrl", "grad_perturb", "post_grad_perturb",
"sudden_perturb", "post_sudden_perturb"))
# 2. Compute Summary Statistics Separately
# Instead of appending to the array, we create a summary table
summary_stats <- df_long %>%
group_by(condition, mask_state) %>%
summarise(
mean_error = mean(error_angle, na.rm = TRUE),
sd_error = sd(error_angle, na.rm = TRUE),
n = n(),
se_error = sd_error / sqrt(n), # Standard Error
.groups = 'drop'
)
print("Summary Statistics:")
print(summary_stats)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
# Boxplot for distribution shape (Median, IQR)
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
# Jitter points to show raw data (Transparency helps see density)
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
# Add Mean points (and error bars if desired)
# This highlights the specific metric you are interested in (CLT argument)
stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
fill = "white", position = position_dodge(width = 0.75)) +
# 4. Statistical Testing (Embedded in Plot)
# method = "wilcox.test" is safer for non-normal data (Mann-Whitney U)
# method = "t.test" uses your CLT logic.
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean; Box = Median/IQR; Stars = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotate x-labels
# Display Plot
print(p)
# 5. Alternative: Explicit T-Test Table (If you prefer precise p-values over plot labels)
# This compares Mask vs Wout_Mask for every condition
stat_results <- df_long %>%
group_by(condition) %>%
rstatix::t_test(error_angle ~ mask_state) %>%
rstatix::add_significance()
print("T-Test Results (CLT Assumption):")
print(stat_results)
# Ensure factor levels are in the logical order you provided (not alphabetical)
df_long$condition <- factor(df_long$condition,
levels = unique(df_long$condition))
View(df_long)
View(df_long)
# Create a 3D array: [40 timepoints, 5 conditions, 2 mask_states]
data_array <- array(combined_data,
dim = c(40, 5, 2),
dimnames = list(
time = 1:40,
condition = conditions,
mask_state = c("with_mask", "wout_mask")
))
# 1. Flatten the Array (The "Tidy" Step)
# This converts your 40x5x2 array into a long dataframe for analysis
df_long <- melt(data_array,
varnames = c("time", "condition", "mask_state"),
value.name = "error_angle")
# Ensure factor levels are in the logical order you provided (not alphabetical)
df_long$condition <- factor(df_long$condition,
levels = unique(df_long$condition))
View(summary_stats)
# 2. Compute Summary Statistics Separately
# Instead of appending to the array, we create a summary table
summary_stats <- df_long %>%
group_by(condition, mask_state) %>%
summarise(
mean_error = mean(error_angle, na.rm = TRUE),
sd_error = sd(error_angle, na.rm = TRUE),
n = n(),
se_error = sd_error / sqrt(n), # Standard Error
.groups = 'drop'
)
print("Summary Statistics:")
print(summary_stats)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotate x-labels
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 5. Alternative: Explicit T-Test Table (If you prefer precise p-values over plot labels)
# This compares Mask vs Wout_Mask for every condition
stat_results <- df_long %>%
group_by(condition) %>%
rstatix::t_test(error_angle ~ mask_state) %>%
rstatix::add_significance()
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 20, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 20, hjust = 0), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 20, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 10, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 5. Alternative: Explicit T-Test Table (If you prefer precise p-values over plot labels)
# This compares Mask vs Wout_Mask for every condition
stat_results <- df_long %>%
group_by(condition) %>%
rstatix::t_test(error_angle ~ mask_state) %>%
rstatix::add_significance()
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = "top") +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 25, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
stat_summary
stat_summary
stat_compare_means
stat_compare_means
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.9) +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 25, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.95) +    # Places label at top
labs(title = "Error Angle Analysis: Mask vs No Mask",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 25, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 5. Alternative: Explicit T-Test Table (If you prefer precise p-values over plot labels)
# This compares Mask vs Wout_Mask for every condition
stat_results <- df_long %>%
group_by(condition) %>%
rstatix::t_test(error_angle ~ mask_state) %>%
rstatix::add_significance()
print("T-Test Results (CLT Assumption):")
print(stat_results)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.95) +    # Places label at top
labs(title = "Angular Error",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
coord_trans(y = "log10") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 25, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.95) +    # Places label at top
labs(title = "Angular Error",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
scale_y_log10()
# Display Plot
print(p)
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.95) +    # Places label at top
labs(title = "Angular Error",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal()
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.95) +    # Places label at top
labs(title = "Angular Error",
subtitle = "White diamonds = Mean;Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 25, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
ggsave("result_statistical_anal.png", plot = p)
custom_save(p, name = "result_statistical_anal")
custom_save <- function(plt, folder = "", name = "", size=1, height = 1, width = 1.5, background = "white"){
library(ggplot2)
if(is.null(plt)){
return("No plot to save\n")
}
#print(plt)
ggsave(paste0(folder, name, ".png"), plt,
height = height*2000*size,
width = width*2000*size,
units = "px",
dpi = 500,
create.dir = T ,
bg = "white")
}
custom_save(p, name = "result_statistical_anal")
# 3. Visualization with Statistical Analysis
# We compare "with_mask" vs "wout_mask" for each condition
p <- ggplot(df_long, aes(x = condition, y = error_angle, fill = mask_state)) +
geom_boxplot(alpha = 0.6, outlier.shape = NA) +
geom_point(position = position_jitterdodge(jitter.width = 0.2),
alpha = 0.3, size = 1) +
#stat_summary(fun = mean, geom = "point", shape = 23, size = 3,
#             fill = "white", position = position_dodge(width = 0.75)) +
stat_compare_means(aes(group = mask_state),
method = "wilcox.test",
label = "p.signif",       # Shows *, **, ns
label.y.npc = 0.95) +    # Places label at top
labs(title = "Angular Error",
subtitle = "Significance = Wilcoxon Test",
y = "Error Angle (deg)",
x = "Condition") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 25, hjust = 1), legend.position = "bottom") # Rotate x-labels
# Display Plot
print(p)
custom_save <- function(plt, folder = "", name = "", size=1, height = 1, width = 1.5, background = "white"){
library(ggplot2)
if(is.null(plt)){
return("No plot to save\n")
}
#print(plt)
ggsave(paste0(folder, name, ".png"), plt,
height = height*2000*size,
width = width*2000*size,
units = "px",
dpi = 500,
create.dir = T ,
bg = "white")
}
custom_save(p, name = "result_statistical_anal")
# 5. Alternative: Explicit T-Test Table (If you prefer precise p-values over plot labels)
# This compares Mask vs Wout_Mask for every condition
stat_results <- df_long %>%
group_by(condition) %>%
rstatix::t_test(error_angle ~ mask_state) %>%
rstatix::add_significance()
print("T-Test Results (CLT Assumption):")
# 5. Alternative: Explicit T-Test Table (If you prefer precise p-values over plot labels)
# This compares Mask vs Wout_Mask for every condition
stat_results <- df_long %>%
group_by(condition) %>%
rstatix::wilcox_test(error_angle ~ mask_state) %>%
rstatix::add_significance()
print("T-Test Results (CLT Assumption):")
print(stat_results)
